<html>
<head>

    @model TestStationStatus.Models.StatusViewModel

    @section scripts{
        @*/* load your scripts here. You can exclude jQuery,
            coz it's already in the template */ *@
    <script src="~/Scripts/jquery-1.10.2.js" type="text/javascript"></script>
        <script src="~/Scripts/bootstrap.js"></script>
        <script src="~/Scripts/jquery.signalR-2.2.1.js"></script>
        <script src="~/signalr/hubs"></script>


    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        var chat;

        $(function () {
            $.connection.hub.logging = true;

            chat = $.connection.yourAppHub;
            chat.client.refreshPage = onNewMessage;

            $.connection.hub.start({ transport: 'longPolling' });
        });

        function onNewMessage(message) {
            // ... todo: validation !!!! :)
            //alert("Updated: ");
            $.ajax({
                url: '',
                success: function (data) {
                    window.location.reload(); // This is not jQuery but simple plain ol' JS
                    if (data == "refresh") {
                    }
                }
            });
        };


        $.connection.hub.error(function (err) {
            alert("An error occured: " + err);
        });
    </script>
    }


</head>

<body>
    <style type="text/css">
        .tg {
            border-collapse: collapse;
            border-spacing: 0;
            border-color: #ccc;
        }

            .tg td {
                font-family: Arial, sans-serif;
                font-size: 14px;
                padding: 10px 5px;
                border-style: solid;
                border-width: 1px;
                overflow: hidden;
                word-break: normal;
                border-color: #ccc;
                color: #333;
                background-color: #fff;
            }

            .tg th {
                font-family: Arial, sans-serif;
                font-size: 14px;
                font-weight: normal;
                padding: 10px 5px;
                border-style: solid;
                border-width: 1px;
                overflow: hidden;
                word-break: normal;
                border-color: #ccc;
                color: #333;
                background-color: #f0f0f0;
            }

            .tg .tg-88oy {
                font-size: xx-small;
                text-align: center;
                vertical-align: top;
            }

            .tg .tg-yw4l {
                vertical-align: top;
            }
    </style>

    <!--<meta http-equiv="refresh" content="10">-->
    @{
        ViewBag.Title = "Index";
    }

    <h2>StatusView</h2>

    <p>
        @Html.ActionLink("Create New", "Create")
        <input type="button" title="Cancel" value="Cancel" onclick="location.href='@Url.Action("Cancel", "Status")'" />
    </p>
    <tr>
        <th></th>
    </tr>

    <div class="editor-label">
        @Html.LabelFor(model => model.ApplicationStatus)
        @Model.ApplicationStatus
    </div>

    <div class="editor-label">
        @Html.LabelFor(model => model.TestScript)
        @Model.TestScript
    </div>

    <div class="editor-label">
        @Html.LabelFor(model => model.LastUpdateTime)
        @Model.LastUpdateTimeString
    </div>

    <table>
        <tr>
            <td>
                <p>Actions</p>
                <table class="tg">

                    @foreach (var item in Model.StatusFile)
            {
                        <tr>
                            <td>
                                @item
                            </td>
                        </tr>
                    }
                </table>
            </td>
            <td>
                <p>Results </p>
                <table class="tg">

                    @foreach (var item in Model.ResultsFile)
            {
                        <tr>
                            <td class="tg-yw4l">
                                @item
                            </td>
                        </tr>
                    }
                </table>
            </td>
        </tr>
    </table>


    <p>Queue</p>
    <table class="tg">

        @foreach (var item in Model.QueueItems)
        {
            <tr>
                <td>
                    @item
                </td>
            </tr>
        }
    </table>

    <p>Monitor</p>
    <table class="tg">

        @foreach (var item in Model.MonitorFiles)
        {
            <tr>
                <td class="tg-yw4l">
                    @item
                </td>
            </tr>
        }
    </table>
</body>
</html>
